webpackJsonp([1],{NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("7+uW"),s=n("fZjL"),a=n.n(s),d=n("mtWM"),o=n.n(d),l={name:"Input",props:["text","title","item"],data:function(){return{propText:this.text||"",propTitle:this.title||"Редактировать"}},computed:{propItem:function(){var t=this.item||{};return t.id||(t.id=0),t},formId:function(){return"form-department"+(this.propItem.department_id?this.propItem.department_id+"employee":"")+this.propItem.id}},methods:{formHandle:function(){var t=this,e="post",n="http://personnel/web/api/"+(this.propItem.department_id?"employees":"departments"),i={name:this.propText};this.propItem.id?(e="put",n+="/"+this.propItem.id):this.propItem.department_id&&(i.department_id=this.propItem.department_id),o()({method:e,url:n,data:i}).then(function(e){t.propText="",t.$emit("saved",e.data)}).catch(function(t){return console.log(t)})}}},r={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("form",{staticClass:"add-form form-inline",on:{submit:function(e){e.preventDefault(),t.formHandle()}}},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"control-label",attrs:{for:t.formId}},[t._v(t._s(t.propTitle))]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.propText,expression:"propText"}],staticClass:"form-control",attrs:{type:"text",id:t.formId},domProps:{value:t.propText},on:{input:function(e){e.target.composing||(t.propText=e.target.value)}}})]),t._v(" "),n("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[t._v("Сохранить")])])},staticRenderFns:[]},p={name:"Departments",data:function(){return{departments:null}},methods:{get:function(){var t=this;o.a.get("http://personnel/web/api/departments?expand=employees").then(function(e){var n={};e.data.map(function(t){t.edit=!1,t.show=!0;var e={};t.employees.map(function(t){t.edit=!1,t.show=!0,e[t.id]=t}),t.employees=e,n[t.id]=t}),t.departments=n}).catch(function(t){return console.log(t)})},editHandle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.id&&(t.edit=!t.edit)},deleteHandle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.id){var e="department",n="отдел "+t.name;if(t.department_id?(n="сотрудника "+t.name,e="employee"):t.employees&&a()(t.employees).length&&(n+=" и всех его сторудников"),window.confirm("Вы действительно хотите удалить "+n+"?")){var i="http://personnel/web/api/"+e+"s/"+t.id;o.a.delete(i).then(function(e){t.show=!1}).catch(function(t){return console.log(t)})}}},insertedHandle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.id&&(t.edit=!1,t.show=!0,t.department_id?this.$set(this.departments[t.department_id].employees,t.id,t):(t.employees={},this.$set(this.departments,t.id,t)))},updatedHandle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.id){var e=t.department_id?this.departments[t.department_id].employees[t.id]:this.departments[t.id];e.edit=!1,e.name=t.name,t.department_id?this.$set(this.departments[t.department_id].employees,t.id,e):this.$set(this.departments,t.id,e)}}},created:function(){this.get()},components:{Input:n("VU/8")(l,r,!1,null,null,null).exports}},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"departments"},[n("transition",[t.departments?n("div",[t._l(t.departments,function(e){return e.show?n("div",{key:"department"+e.id,staticClass:"panel panel-default"},[n("div",{staticClass:"panel-heading"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-xs-8 col-md-10"},[e.edit?n("div",[n("Input",{staticClass:"pull-left",attrs:{text:e.name,item:e},on:{saved:t.updatedHandle}}),t._v(" "),n("button",{staticClass:"btn btn-link",on:{click:function(n){t.editHandle(e,!1)}}},[t._v("Отменить")])],1):n("h4",[t._v(t._s(e.name))])]),t._v(" "),n("div",{staticClass:"col-xs-4 col-md-2 text-right"},[n("button",{staticClass:"btn btn-default btn-sm",on:{click:function(n){t.editHandle(e)}}},[n("span",{staticClass:"glyphicon glyphicon-edit"})]),t._v(" "),n("button",{staticClass:"btn btn-danger btn-sm",on:{click:function(n){t.deleteHandle(e)}}},[n("span",{staticClass:"glyphicon glyphicon-minus"})])])])]),t._v(" "),n("ul",{staticClass:"employees list-group"},t._l(e.employees,function(i){return i.show?n("li",{key:"department"+e.id+"employee"+i.id,staticClass:"list-group-item"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-xs-8 col-md-10"},[i.edit?n("div",[n("Input",{staticClass:"pull-left",attrs:{text:i.name,item:i},on:{saved:t.updatedHandle}}),t._v(" "),n("button",{staticClass:"btn btn-link",on:{click:function(e){t.editHandle(i,!1)}}},[t._v("Отменить")])],1):n("div",[t._v(t._s(i.name))])]),t._v(" "),n("div",{staticClass:"col-xs-4 col-md-2 text-right"},[n("button",{staticClass:"btn btn-default btn-sm",on:{click:function(e){t.editHandle(i)}}},[n("span",{staticClass:"glyphicon glyphicon-edit"})]),t._v(" "),n("button",{staticClass:"btn btn-danger btn-sm",on:{click:function(e){t.deleteHandle(i)}}},[n("span",{staticClass:"glyphicon glyphicon-minus"})])])])]):t._e()})),t._v(" "),n("div",{staticClass:"panel-body"},[n("Input",{attrs:{title:"Добавить сотрудника",item:{department_id:e.id}},on:{saved:t.insertedHandle}})],1)]):t._e()}),t._v(" "),n("Input",{attrs:{title:"Добавить отдел"},on:{saved:t.insertedHandle}})],2):n("div",[t._v("\n      Loading...\n    ")])])],1)},staticRenderFns:[]},m={name:"App",components:{Departments:n("VU/8")(p,c,!1,null,null,null).exports}},u={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("Departments")],1)},staticRenderFns:[]},v=n("VU/8")(m,u,!1,null,null,null).exports;i.a.config.productionTip=!1,new i.a({el:"#app",components:{App:v},template:"<App/>"})}},["NHnr"]);
//# sourceMappingURL=app.ef61157a200793bf2882.js.map